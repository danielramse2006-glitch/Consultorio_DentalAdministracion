<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Consultorio Dental - Sistema de Visitas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .container {
            max-width: 1200px;
        }
        .header {
            background: linear-gradient(135deg, #2c8ab9 0%, #1a6a9e 100%);
            color: white;
            padding: 2rem 0;
            border-radius: 0 0 10px 10px;
            margin-bottom: 2rem;
        }
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .btn-dental {
            background-color: #2c8ab9;
            color: white;
        }
        .btn-dental:hover {
            background-color: #1a6a9e;
            color: white;
        }
        .table th {
            background-color: #2c8ab9;
            color: white;
        }
        .table-hover tbody tr:hover {
            background-color: rgba(44, 138, 185, 0.1);
        }
        .form-container {
            background-color: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .alert-empty {
            padding: 3rem;
            text-align: center;
            font-size: 1.2rem;
        }
        .footer {
            margin-top: 3rem;
            padding: 1.5rem 0;
            text-align: center;
            color: #6c757d;
            border-top: 1px solid #dee2e6;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="display-5 fw-bold">Consultorio Dental Sonrisa Saludable</h1>
                    <p class="lead">Sistema de Gestión de Visitas de Pacientes</p>
                </div>
                <div class="col-md-4 text-end">
                    <div class="d-inline-block bg-white text-dark p-3 rounded">
                        <div class="fw-bold">Total de Visitas</div>
                        <div id="total-visitas" class="h2 mb-0">1</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Panel principal -->
        <div id="main-panel">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="h3 mb-0">Registro de Visitas</h2>
                <button id="btn-nueva-visita" class="btn btn-success btn-lg">
                    <i class="bi bi-plus-circle"></i> Registrar Nueva Visita
                </button>
            </div>

            <!-- Tabla de visitas -->
            <div id="visitas-table-container" class="card">
                <div class="card-body p-0">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Apellido</th>
                                <th>Cédula</th>
                                <th>Edad</th>
                                <th>Motivo</th>
                                <th>Fecha y Hora</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="visitas-body">
                            <!-- Las visitas se cargarán aquí con JavaScript -->
                        </tbody>
                    </table>
                    <div id="empty-message" class="alert-empty" style="display: none;">
                        <div class="mb-3">
                            <i class="bi bi-calendar-x" style="font-size: 3rem; color: #6c757d;"></i>
                        </div>
                        <h4>No hay visitas registradas</h4>
                        <p class="text-muted">Comienza registrando una nueva visita haciendo clic en el botón "Registrar Nueva Visita"</p>
                    </div>
                </div>
            </div>

            <!-- Información del sistema -->
            <div class="row mt-4">
                <div class="col-md-4 mb-3">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="card-title">Instrucciones</h5>
                            <p class="card-text">Este sistema te permite gestionar las visitas de pacientes al consultorio dental.</p>
                            <ul class="list-unstyled">
                                <li><i class="bi bi-plus-circle text-success"></i> <strong>Registrar:</strong> Añade nuevas visitas</li>
                                <li><i class="bi bi-pencil-square text-warning"></i> <strong>Editar:</strong> Modifica visitas existentes</li>
                                <li><i class="bi bi-trash text-danger"></i> <strong>Eliminar:</strong> Elimina visitas del sistema</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="card-title">Datos de Ejemplo</h5>
                            <p class="card-text">El sistema incluye un paciente de ejemplo:</p>
                            <div class="bg-light p-3 rounded">
                                <p class="mb-1"><strong>Nombre:</strong> Son Goku</p>
                                <p class="mb-1"><strong>Cédula:</strong> 001</p>
                                <p class="mb-1"><strong>Edad:</strong> 22</p>
                                <p class="mb-0"><strong>Motivo:</strong> Dolor de muelas</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="card-title">Información Técnica</h5>
                            <p class="card-text">Esta es una versión HTML/JS del sistema original en PHP.</p>
                            <p class="card-text">Los datos se almacenan en el navegador (LocalStorage) y se perderán al cerrar la página.</p>
                            <p class="small text-muted">Desarrollado por: Ismel Amaury AM<br>Matrícula: 20231886</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Panel de registro de nueva visita -->
        <div id="registrar-panel" class="form-container" style="display: none;">
            <h2 class="mb-4">Nueva Visita</h2>
            <form id="form-registrar">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Nombre</label>
                        <input type="text" id="nombre" name="nombre" class="form-control" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Apellido</label>
                        <input type="text" id="apellido" name="apellido" class="form-control" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Cédula</label>
                        <input type="text" id="cedula" name="cedula" class="form-control" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Edad</label>
                        <input type="number" id="edad" name="edad" class="form-control" min="0" required>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="form-label">Motivo de la visita</label>
                    <input type="text" id="motivo" name="motivo" class="form-control" required>
                </div>
                <div class="d-flex justify-content-between">
                    <button type="button" id="btn-cancelar-registro" class="btn btn-secondary">← Cancelar</button>
                    <button type="submit" class="btn btn-primary">Registrar Visita</button>
                </div>
            </form>
        </div>

        <!-- Panel de edición de visita -->
        <div id="editar-panel" class="form-container" style="display: none;">
            <h2 class="mb-4">Editar Visita</h2>
            <form id="form-editar">
                <input type="hidden" id="edit-index">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Nombre</label>
                        <input type="text" id="edit-nombre" name="nombre" class="form-control" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Apellido</label>
                        <input type="text" id="edit-apellido" name="apellido" class="form-control" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Cédula</label>
                        <input type="text" id="edit-cedula" name="cedula" class="form-control" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Edad</label>
                        <input type="number" id="edit-edad" name="edad" class="form-control" min="0" required>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="form-label">Motivo de la visita</label>
                    <input type="text" id="edit-motivo" name="motivo" class="form-control" required>
                </div>
                <div class="d-flex justify-content-between">
                    <button type="button" id="btn-cancelar-edicion" class="btn btn-secondary">← Cancelar</button>
                    <button type="submit" class="btn btn-warning">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>

    <div class="footer">
        <div class="container">
            <p>Sistema de Gestión de Consultorio Dental - Versión HTML/JS | Desarrollado por Ismel Amaury AM (20231886)</p>
            <p class="small">Esta es una versión de demostración. Los datos se almacenan localmente en el navegador.</p>
        </div>
    </div>

    <!-- Modal de confirmación para eliminar -->
    <div class="modal fade" id="confirmModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirmar eliminación</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    ¿Estás seguro de que deseas eliminar esta visita? Esta acción no se puede deshacer.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" id="btn-confirm-delete" class="btn btn-danger">Eliminar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Datos iniciales - basados en visitas.json
        let visitas = [
            {
                nombre: "Son",
                apellido: "Goku",
                cedula: "001",
                edad: 22,
                motivo: "Dolor de muelas",
                fecha_hora: "2025-06-14 04:21:34"
            }
        ];

        // Cargar datos desde localStorage si existen
        function cargarVisitas() {
            const datosGuardados = localStorage.getItem('visitasDentales');
            if (datosGuardados) {
                visitas = JSON.parse(datosGuardados);
            }
            actualizarInterfaz();
        }

        // Guardar datos en localStorage
        function guardarVisitas() {
            localStorage.setItem('visitasDentales', JSON.stringify(visitas));
            actualizarInterfaz();
        }

        // Actualizar la interfaz con los datos actuales
        function actualizarInterfaz() {
            const visitasBody = document.getElementById('visitas-body');
            const totalVisitas = document.getElementById('total-visitas');
            const emptyMessage = document.getElementById('empty-message');
            
            totalVisitas.textContent = visitas.length;
            
            if (visitas.length === 0) {
                visitasBody.innerHTML = '';
                emptyMessage.style.display = 'block';
                return;
            }
            
            emptyMessage.style.display = 'none';
            
            let html = '';
            visitas.forEach((visita, index) => {
                html += `
                    <tr>
                        <td>${visita.nombre}</td>
                        <td>${visita.apellido}</td>
                        <td>${visita.cedula}</td>
                        <td>${visita.edad}</td>
                        <td>${visita.motivo}</td>
                        <td>${visita.fecha_hora}</td>
                        <td>
                            <button class="btn btn-sm btn-warning btn-editar" data-index="${index}">
                                <i class="bi bi-pencil-square"></i> Editar
                            </button>
                            <button class="btn btn-sm btn-danger btn-eliminar" data-index="${index}">
                                <i class="bi bi-trash"></i> Eliminar
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            visitasBody.innerHTML = html;
            
            // Añadir eventos a los botones recién creados
            document.querySelectorAll('.btn-editar').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = this.getAttribute('data-index');
                    mostrarEdicion(index);
                });
            });
            
            document.querySelectorAll('.btn-eliminar').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = this.getAttribute('data-index');
                    mostrarConfirmacionEliminar(index);
                });
            });
        }

        // Mostrar panel de registro
        function mostrarRegistro() {
            document.getElementById('main-panel').style.display = 'none';
            document.getElementById('registrar-panel').style.display = 'block';
            document.getElementById('editar-panel').style.display = 'none';
            
            // Limpiar formulario
            document.getElementById('form-registrar').reset();
        }

        // Mostrar panel de edición
        function mostrarEdicion(index) {
            const visita = visitas[index];
            
            document.getElementById('main-panel').style.display = 'none';
            document.getElementById('registrar-panel').style.display = 'none';
            document.getElementById('editar-panel').style.display = 'block';
            
            // Llenar formulario con datos de la visita
            document.getElementById('edit-index').value = index;
            document.getElementById('edit-nombre').value = visita.nombre;
            document.getElementById('edit-apellido').value = visita.apellido;
            document.getElementById('edit-cedula').value = visita.cedula;
            document.getElementById('edit-edad').value = visita.edad;
            document.getElementById('edit-motivo').value = visita.motivo;
        }

        // Mostrar panel principal
        function mostrarPrincipal() {
            document.getElementById('main-panel').style.display = 'block';
            document.getElementById('registrar-panel').style.display = 'none';
            document.getElementById('editar-panel').style.display = 'none';
        }

        // Mostrar confirmación para eliminar
        let visitaAEliminar = null;
        function mostrarConfirmacionEliminar(index) {
            visitaAEliminar = index;
            const modal = new bootstrap.Modal(document.getElementById('confirmModal'));
            modal.show();
        }

        // Formatear fecha actual para nueva visita
        function obtenerFechaActual() {
            const ahora = new Date();
            const año = ahora.getFullYear();
            const mes = String(ahora.getMonth() + 1).padStart(2, '0');
            const dia = String(ahora.getDate()).padStart(2, '0');
            const horas = String(ahora.getHours()).padStart(2, '0');
            const minutos = String(ahora.getMinutes()).padStart(2, '0');
            const segundos = String(ahora.getSeconds()).padStart(2, '0');
            
            return `${año}-${mes}-${dia} ${horas}:${minutos}:${segundos}`;
        }

        // Inicializar eventos cuando el DOM esté cargado
        document.addEventListener('DOMContentLoaded', function() {
            cargarVisitas();
            
            // Botón para nueva visita
            document.getElementById('btn-nueva-visita').addEventListener('click', mostrarRegistro);
            
            // Botón para cancelar registro
            document.getElementById('btn-cancelar-registro').addEventListener('click', mostrarPrincipal);
            
            // Botón para cancelar edición
            document.getElementById('btn-cancelar-edicion').addEventListener('click', mostrarPrincipal);
            
            // Formulario de registro
            document.getElementById('form-registrar').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const nuevaVisita = {
                    nombre: document.getElementById('nombre').value.trim(),
                    apellido: document.getElementById('apellido').value.trim(),
                    cedula: document.getElementById('cedula').value.trim(),
                    edad: parseInt(document.getElementById('edad').value),
                    motivo: document.getElementById('motivo').value.trim(),
                    fecha_hora: obtenerFechaActual()
                };
                
                visitas.push(nuevaVisita);
                guardarVisitas();
                mostrarPrincipal();
                
                // Mostrar mensaje de éxito
                alert('Visita registrada exitosamente!');
            });
            
            // Formulario de edición
            document.getElementById('form-editar').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const index = document.getElementById('edit-index').value;
                const fechaOriginal = visitas[index].fecha_hora;
                
                visitas[index] = {
                    nombre: document.getElementById('edit-nombre').value.trim(),
                    apellido: document.getElementById('edit-apellido').value.trim(),
                    cedula: document.getElementById('edit-cedula').value.trim(),
                    edad: parseInt(document.getElementById('edit-edad').value),
                    motivo: document.getElementById('edit-motivo').value.trim(),
                    fecha_hora: fechaOriginal  // Mantener la fecha original
                };
                
                guardarVisitas();
                mostrarPrincipal();
                
                // Mostrar mensaje de éxito
                alert('Visita actualizada exitosamente!');
            });
            
            // Confirmación de eliminación
            document.getElementById('btn-confirm-delete').addEventListener('click', function() {
                if (visitaAEliminar !== null) {
                    visitas.splice(visitaAEliminar, 1);
                    guardarVisitas();
                    
                    // Cerrar modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('confirmModal'));
                    modal.hide();
                    
                    // Mostrar mensaje de éxito
                    alert('Visita eliminada exitosamente!');
                    
                    visitaAEliminar = null;
                }
            });
            
            // Botón para limpiar todos los datos (oculto, solo para desarrollo)
            const btnLimpiar = document.createElement('button');
            btnLimpiar.textContent = 'Limpiar datos';
            btnLimpiar.className = 'btn btn-sm btn-outline-secondary';
            btnLimpiar.style.position = 'fixed';
            btnLimpiar.style.bottom = '10px';
            btnLimpiar.style.right = '10px';
            btnLimpiar.style.zIndex = '1000';
            btnLimpiar.addEventListener('click', function() {
                if (confirm('¿Estás seguro de que deseas eliminar todos los datos? Esto no se puede deshacer.')) {
                    localStorage.removeItem('visitasDentales');
                    visitas = [];
                    actualizarInterfaz();
                    alert('Todos los datos han sido eliminados.');
                }
            });
            document.body.appendChild(btnLimpiar);
        });
    </script>
</body>
</html>
